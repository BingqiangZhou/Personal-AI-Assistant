# 播客AI总结功能

## 基本信息
- **需求ID**: REQ-20251223-001
- **创建日期**: 2025-12-23
- **最后更新**: 2025-12-23
- **负责人**: 产品经理
- **状态**: Active
- **优先级**: High

## 需求描述

### 用户故事
作为播客听众，我想要为转录完成的播客内容生成AI总结，以便快速了解播客的核心内容，决定是否值得完整收听。

### 业务价值
- 提升用户体验：用户可以在几分钟内了解一小时播客的核心内容
- 提高内容消费效率：帮助用户筛选有价值的播客内容
- 增强产品竞争力：AI总结是播客应用的差异化功能
- 数据反馈：通过总结使用情况了解用户偏好

### 背景信息
- **当前状况**：转录功能已完成，但转录文本往往很长（数千字），用户难以快速获取核心信息
- **用户痛点**：
  - 转录内容太长，阅读耗时
  - 需要快速判断播客是否值得完整收听
  - 希望获得结构化的内容概要
- **机会点**：利用现有的AI模型配置系统，实现灵活的AI总结功能

## 功能需求

### 核心功能
- [FR-001] 为已完成转录的播客生成AI总结
- [FR-002] 支持重新生成总结（可切换模型或自定义提示词）
- [FR-003] 显示AI总结的元数据（模型、处理时间等）
- [FR-004] 提供多种AI模型选择
- [FR-005] 支持自定义总结提示词
- [FR-006] 转录完成后自动触发AI总结

### 功能详述

#### 功能1：生成AI总结
- **描述**：用户可以为已转录的播客生成AI总结
- **输入**：播客ID、可选模型名称、可选自定义提示词
- **处理**：
  1. 验证播客存在且已转录
  2. 获取转录文本内容
  3. 调用AI模型生成总结
  4. 保存总结到数据库
  5. 更新播客摘要信息
- **输出**：AI总结内容、模型信息、处理时间

#### 功能2：重新生成总结
- **描述**：用户可以重新生成总结，支持切换模型或修改提示词
- **输入**：播客ID、可选模型、可选自定义提示词
- **处理**：
  1. 清除现有总结
  2. 重新调用AI模型
  3. 更新数据库
- **输出**：新的AI总结内容

#### 功能3：显示总结元数据
- **描述**：在UI中显示总结的详细信息
- **输入**：播客ID
- **输出**：
  - 总结内容
  - 使用的模型名称
  - 生成时间
  - 字数统计

#### 功能4：转录完成后自动触发AI总结
- **描述**：当播客单集转录完成后，系统自动触发AI总结生成
- **输入**：转录完成的播客单集ID
- **处理**：
  1. 转录任务完成后，自动调用AI总结服务
  2. 使用默认模型和提示词生成总结
  3. 保存总结到数据库
  4. 更新播客单集的AI总结字段
- **输出**：自动生成的AI总结
- **特点**：
  - 异步处理，不阻塞转录流程
  - 详细的日志记录
  - 完善的错误处理
  - 支持失败重试

## 非功能需求

### 性能要求
- 响应时间：总结生成时间取决于AI模型，一般10-60秒
- 并发用户：支持多个用户同时生成总结
- 超时处理：5分钟超时限制

### 安全要求
- 身份验证：需要用户登录
- 权限控制：只能访问自己的播客
- API密钥安全：使用数据库加密存储API密钥

### 可用性要求
- 错误处理：AI服务失败时显示友好错误信息
- 降级方案：使用备用模型或稍后重试

### 兼容性要求
- 后端：使用现有的DatabaseBackedAISummaryService
- 前端：Material 3设计规范，响应式布局

## 任务分解

### Backend任务
- [x] [TASK-B-001] 验证并更新后端AI总结API
  - **负责人**: Backend Developer
  - **预估工时**: 2小时
  - **验收标准**:
    - [x] API端点使用DatabaseBackedAISummaryService
    - [x] 支持获取可用模型列表
    - [x] 错误处理完善
  - **状态**: Completed

- [x] [TASK-B-002] 添加模型列表查询API
  - **负责人**: Backend Developer
  - **预估工时**: 1小时
  - **验收标准**:
    - [x] GET /podcasts/summary/models 端点
    - [x] 返回可用的文本生成模型列表
  - **状态**: Completed

- [x] [TASK-B-003] 实现转录完成后自动触发AI总结
  - **负责人**: Backend Developer
  - **预估工时**: 2小时
  - **验收标准**:
    - [x] 转录完成后自动调用AI总结服务
    - [x] 异步处理，不阻塞转录流程
    - [x] 详细的日志记录
    - [x] 完善的错误处理
  - **状态**: Completed

### Frontend任务
- [ ] [TASK-F-001] 创建AI总结控制UI组件
  - **负责人**: Frontend Developer
  - **预估工时**: 3小时
  - **验收标准**:
    - [ ] 生成总结按钮
    - [ ] 重新生成按钮
    - [ ] 模型选择器（可选）
    - [ ] 自定义提示词输入（可选）
    - [ ] Material 3设计规范
  - **状态**: Todo

- [ ] [TASK-F-002] 创建总结显示组件
  - **负责人**: Frontend Developer
  - **预估工时**: 2小时
  - **验收标准**:
    - [ ] 显示总结内容
    - [ ] 显示元数据（模型、时间）
    - [ ] 加载状态指示器
    - [ ] 错误状态显示
  - **状态**: Todo

- [ ] [TASK-F-003] 集成到Episode Detail页面
  - **负责人**: Frontend Developer
  - **预估工时**: 1小时
  - **验收标准**:
    - [ ] 在AI Summary标签页中集成控制UI
    - [ ] 仅在有转录内容时显示生成按钮
    - [ ] 响应式布局适配
  - **状态**: Todo

- [ ] [TASK-F-004] 添加Provider和Repository层
  - **负责人**: Frontend Developer
  - **预估工时**: 2小时
  - **验收标准**:
    - [ ] summaryProvider状态管理
    - [ ] generateSummary方法
    - [ ] getSummaryModels方法
    - [ ] 错误处理
  - **状态**: Todo

### 测试任务
- [ ] [TASK-T-001] 编写Widget测试
  - **负责人**: Test Engineer
  - **预估工时**: 2小时
  - **验收标准**:
    - [ ] 测试加载状态
    - [ ] 测试成功状态
    - [ ] 测试错误状态
    - [ ] 测试用户交互
  - **状态**: Todo

- [ ] [TASK-T-002] 编写API集成测试
  - **负责人**: Test Engineer
  - **预估工时**: 1小时
  - **验收标准**:
    - [ ] 测试生成总结API
    - [ ] 测试重新生成API
    - [ ] 测试模型列表API
  - **状态**: Todo

## 验收标准

### 整体验收
- [ ] 用户可以为已转录的播客生成AI总结
- [ ] 总结内容准确反映播客核心内容
- [ ] 支持切换模型和自定义提示词
- [ ] UI符合Material 3设计规范

### 用户验收标准
- [ ] 点击"生成总结"按钮后显示加载状态
- [ ] 总结生成成功后显示总结内容和元数据
- [ ] 可以切换模型重新生成总结
- [ ] 错误信息清晰友好

### 技术验收标准
- [ ] 使用DatabaseBackedAISummaryService
- [ ] API响应正确，状态码准确
- [ ] 前端Widget测试覆盖率 > 80%
- [ ] 代码通过静态分析

## 设计约束

### 技术约束
- 必须使用现有的AI模型配置系统
- 必须使用DatabaseBackedAISummaryService
- 前端必须使用Material 3设计规范
- 必须使用Riverpod进行状态管理

### 业务约束
- 只有已转录的播客才能生成总结
- 用户只能操作自己的播客

### 环境约束
- 需要配置AI模型API密钥
- 依赖转录功能先完成

## 风险评估

### 技术风险
| 风险项 | 概率 | 影响 | 缓解措施 |
|--------|------|------|----------|
| AI API超时 | 中 | 中 | 设置5分钟超时，提供重试选项 |
| AI API失败 | 低 | 高 | 使用多个可用模型，显示错误提示 |
| 总结质量不稳定 | 中 | 中 | 允许用户重新生成和自定义提示词 |

### 业务风险
| 风险项 | 概率 | 影响 | 缓解措施 |
|--------|------|------|----------|
| API成本超预算 | 低 | 中 | 设置使用限额和监控 |
| 用户不满意总结质量 | 中 | 低 | 支持重新生成和反馈机制 |

## 依赖关系

### 外部依赖
- OpenAI API或其他AI服务提供商
- 现有的AI模型配置系统

### 内部依赖
- 转录功能（必须先完成转录）
- AI模型配置管理模块
- 用户认证系统

## 时间线

### 里程碑
- **需求确认**: 2025-12-23
- **开发完成**: 2025-12-23
- **测试完成**: 2025-12-23
- **上线发布**: 待定

### 关键路径
1. Backend API验证/更新 (1小时)
2. Frontend Provider和Repository (2小时)
3. Frontend UI组件实现 (3小时)
4. 集成和测试 (2小时)

## 变更记录

| 版本 | 日期 | 变更内容 | 变更人 | 审批人 |
|------|------|----------|--------|--------|
| 1.0 | 2025-12-23 | 初始创建 | Claude AI | 产品经理 |

## 相关文档
- [转录功能需求文档](./podcast-transcription-development-plan.md)
- [AI模型配置文档](../../backend/app/domains/ai/README.md)

## 审批

### 需求评审
- [ ] 产品负责人审批
- [ ] 技术负责人审批
- [ ] QA负责人审批

---

**注意**: 本文档是工作过程中的核心文档，请及时更新并保持版本同步。
