# 播客转录功能验收标准与测试计划

**文档ID**: TEST-PLAN-2025-001
**创建日期**: 2025-12-21
**负责人**: 测试工程师
**状态**: 草稿

## 1. 验收测试概述

### 1.1 测试目标
确保播客转录功能满足以下要求：
- 功能完整性
- 性能达标
- 用户体验良好
- 系统稳定可靠

### 1.2 测试范围
- 后端音频转录服务
- 前端转录文本显示
- Shownotes显示功能
- 系统集成测试
- 性能和压力测试

### 1.3 测试环境
- **开发环境**: 本地Docker + Flutter开发模式
- **测试环境**: 测试服务器 + 发布版Flutter应用
- **生产环境**: 生产服务器（发布前验证）

## 2. 后端验收测试标准

### 2.1 音频处理功能测试

#### 测试用例 AP-001：音频下载
**测试步骤**:
1. 提供有效的播客音频URL
2. 触发下载任务
3. 验证文件下载到指定位置

**预期结果**:
- [ ] 音频文件成功下载
- [ ] 文件大小正确
- [ ] 文件格式识别正确
- [ ] 下载失败有错误提示

**测试数据**:
- 有效URL: https://example.com/podcast.mp3
- 无效URL: https://invalid-url.com
- 大文件: >100MB
- 小文件: <1MB

#### 测试用例 AP-002：格式转换
**测试步骤**:
1. 准备不同格式的音频文件（WAV, M4A, OGG）
2. 执行格式转换
3. 验证输出为MP3格式

**预期结果**:
- [ ] 所有格式成功转换为MP3
- [ ] 音质保持可接受水平
- [ ] 元数据保留（标题、艺术家等）
- [ ] 转换失败的错误处理

#### 测试用例 AP-003：文件切割
**测试步骤**:
1. 准备>10MB的MP3文件
2. 执行文件切割（设置为10MB）
3. 验证切割结果

**预期结果**:
- [ ] 文件按10MB大小切割
- [ ] 切割点不会截断音频
- [ ] 保持时间戳连续性
- [ ] 生成正确的文件列表

### 2.2 转录服务测试

#### 测试用例 TS-001：API集成
**测试步骤**:
1. 准备测试音频文件
2. 调用硅基流动API
3. 验证转录结果

**预期结果**:
- [ ] API调用成功
- [ ] 返回转录文本
- [ ] 准确率>95%
- [ ] API限流处理正确

#### 测试用例 TS-002：并发处理
**测试步骤**:
1. 同时提交多个转录任务
2. 设置最大线程数为4
3. 验证任务队列行为

**预期结果**:
- [ ] 最多4个并发任务
- [ ] 超出任务进入队列
- [ ] 任务按顺序执行
- [ ] 资源使用合理

#### 测试用例 TS-003：错误处理
**测试步骤**:
1. 使用无效的API密钥
2. 提交损坏的音频文件
3. 模拟网络中断

**预期结果**:
- [ ] API密钥错误有明确提示
- [ ] 损坏文件被正确识别
- [ ] 网络中断有重试机制
- [ ] 错误日志完整记录

### 2.3 API接口测试

#### 测试用例 API-001：创建转录任务
```http
POST /api/v1/podcast/episodes/{episode_id}/transcribe
```

**测试步骤**:
1. 发送有效的episode_id
2. 验证响应格式
3. 检查任务创建状态

**预期结果**:
```json
{
  "task_id": "uuid",
  "status": "queued",
  "message": "Transcription task created successfully"
}
```

#### 测试用例 API-002：查询转录状态
```http
GET /api/v1/podcast/episodes/{episode_id}/transcription
```

**测试步骤**:
1. 查询进行中的任务
2. 查询完成的任务
3. 查询失败的任务

**预期结果**:
- 状态值正确：queued/processing/completed/failed
- 进度百分比准确
- 转录文本在完成时返回

### 2.4 性能测试

#### 测试用例 PT-001：大文件处理
**测试场景**:
- 文件大小: 100MB
- 并发数: 4
- 预期完成时间: <文件时长 * 0.5

**验收标准**:
- [ ] 处理时间达标
- [ ] 内存使用不超过1GB
- [ ] CPU使用率<80%
- [ ] 临时文件自动清理

#### 测试用例 PT-002：系统负载
**测试场景**:
- 24小时持续运行
- 每小时10个转录任务
- 监控系统资源

**验收标准**:
- [ ] 系统稳定运行
- [ ] 无内存泄漏
- [ ] 错误率<1%
- [ ] 任务队列不堆积

## 3. 前端验收测试标准

### 3.1 Shownotes显示测试

#### 测试用例 SN-001：基础显示
**测试步骤**:
1. 访问有shownotes的播客
2. 切换到"简介"标签
3. 验证内容显示

**预期结果**:
- [ ] HTML内容正确渲染
- [ ] 链接可点击
- [ ] 图片正常显示
- [ ] 格式化正确（列表、粗体等）

#### 测试用例 SN-002：空状态处理
**测试步骤**:
1. 访问没有shownotes的播客
2. 验证空状态显示

**预期结果**:
- [ ] 显示友好提示信息
- [ ] 不显示空白区域
- [ ] UI布局保持正常

### 3.2 转录文本显示测试

#### 测试用例 TT-001：基础显示
**测试步骤**:
1. 访问有转录的播客
2. 切换到"转录"标签
3. 验证文本显示

**预期结果**:
- [ ] 完整转录文本显示
- [ ] 文本格式清晰
- [ ] 可以滚动查看
- [ ] 字体大小可调节

#### 测试用例 TT-002：搜索功能
**测试步骤**:
1. 输入搜索关键词
2. 验证搜索结果
3. 测试高亮显示

**预期结果**:
- [ ] 实时搜索响应
- [ ] 匹配文本高亮
- [ ] 搜索计数准确
- [ ] 清除搜索恢复正常

#### 测试用例 TT-003：状态显示
**测试步骤**:
1. 访问转录中的播客
2. 验证进度显示
3. 等待转录完成

**预期结果**:
- [ ] 显示转录状态
- [ ] 进度条准确
- [ ] 完成后自动刷新
- [ ] 错误状态有提示

### 3.3 音频同步测试（可选）

#### 测试用例 AS-001：播放同步
**测试步骤**:
1. 播放带转录的音频
2. 观察文本高亮
3. 验证同步准确度

**预期结果**:
- [ ] 当前段落自动高亮
- [ ] 滚动位置准确
- [ ] 时间戳匹配
- [ ] 延迟<500ms

#### 测试用例 AS-002：点击跳转
**测试步骤**:
1. 点击转录文本段落
2. 验证音频跳转
3. 检查播放位置

**预期结果**:
- [ ] 音频跳转到正确位置
- [ ] 播放状态保持
- [ ] 时间误差<2秒

### 3.4 响应式设计测试

#### 测试用例 RD-001：多设备适配
**测试设备**:
- 桌面（1920x1080）
- 平板（768x1024）
- 手机（375x667）

**验收标准**:
- [ ] 布局自适应
- [ ] 文字可读
- [ ] 交互正常
- [ ] 无横向滚动

## 4. 集成测试

### 4.1 端到端流程测试

#### 测试用例 E2E-001：完整转录流程
**测试场景**:
1. 用户订阅新播客
2. 系统自动抓取新分集
3. 触发转录任务
4. 用户在前端查看结果

**验收标准**:
- [ ] 自动转录启动
- [ ] 状态正确更新
- [ ] 前端实时显示
- [ ] 完整功能可用

### 4.2 数据一致性测试

#### 测试用例 DC-001：数据同步
**测试步骤**:
1. 后端更新转录状态
2. 刷新前端页面
3. 验证数据一致性

**验收标准**:
- [ ] 状态实时同步
- [ ] 文本内容一致
- [ ] 时间戳准确
- [ ] 无数据丢失

## 5. 安全测试

### 5.1 API安全测试

#### 测试用例 SEC-001：认证授权
**测试场景**:
- 未认证访问
- 无效token访问
- 越权访问他人数据

**验收标准**:
- [ ] 所有未认证请求被拒绝
- [ ] Token验证正常
- [ ] 数据隔离有效

### 5.2 文件安全测试

#### 测试用例 SEC-002：文件处理
**测试场景**:
- 恶意文件上传
- 文件大小超限
- 路径遍历攻击

**验收标准**:
- [ ] 恶意文件被拒绝
- [ ] 大小限制生效
- [ ] 路径安全检查

## 6. 测试执行计划

### 6.1 测试阶段安排

| 阶段 | 时间 | 负责人 | 内容 |
|------|------|-------|------|
| 单元测试 | 开发过程中 | 各工程师 | 代码级测试 |
| 集成测试 | Day 5, 9 | 测试工程师 | 模块集成测试 |
| 系统测试 | Day 10-11 | 测试工程师 | 端到端测试 |
| 用户验收测试 | Day 12 | 产品经理 + 用户 | 业务验收 |

### 6.2 测试工具

- **后端**: pytest, locust (性能测试)
- **前端**: flutter_test, integration_test
- **API测试**: Postman, Newman
- **性能监控**: Prometheus, Grafana

### 6.3 Bug跟踪

使用GitHub Issues跟踪，优先级定义：
- P0: 阻塞发布
- P1: 影响核心功能
- P2: 次要功能问题
- P3: 优化建议

## 7. 测试报告模板

### 7.1 测试执行摘要
- 测试用例总数: ____
- 通过数: ____
- 失败数: ____
- 覆盖率: ____

### 7.2 缺陷列表
| ID | 优先级 | 模块 | 描述 | 状态 | 负责人 |
|----|-------|------|------|------|-------|

### 7.3 测试结论
- [ ] 功能完整性 ✓
- [ ] 性能达标 ✓
- [ ] 安全性 ✓
- [ ] 用户体验 ✓

## 8. 回归测试计划

### 8.1 自动化回归
- 每日构建触发
- 核心功能自动化
- 性能基准监控

### 8.2 手动回归
- 发布前全量测试
- 重点关注修改模块
- 跨平台兼容性

## 9. 验收签字

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 产品经理 | | | |
| 后端工程师 | | | |
| 前端工程师 | | | |
| 测试工程师 | | | |
| DevOps工程师 | | | |

## 10. 上线标准

功能必须满足以下条件才能上线：
- [ ] 所有P0级别bug修复
- [ ] 核心功能测试100%通过
- [ ] 性能指标达到要求
- [ ] 安全测试通过
- [ ] 用户体验验收
- [ ] 文档完整
- [ ] 监控告警配置完成