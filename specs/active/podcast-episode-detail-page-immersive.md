# 播客详情页面沉浸式布局优化 - 新需求

## 基本信息
- **需求ID**: REQ-20241220-003
- **创建日期**: 2025-12-20
- **最后更新**: 2025-12-20
- **负责人**: 产品经理
- **状态**: 🔄 进行中
- **优先级**: High

## 需求描述

### 用户故事
作为播客听众，我希望播客详情页面采用沉浸式布局设计，拥有清晰的三栏结构和直观的播放控制，能够快速获取关键信息并享受流畅的播放体验。

### 业务价值
1. **提升信息获取效率**：通过三栏布局，同时展示转录内容和AI总结
2. **增强沉浸体验**：无分割线的头部设计，专注于内容
3. **优化播放控制**：底部沉浸式播放条，操作更直观
4. **提升视觉层次**：清晰的区域划分，更好的视觉引导

### 设计参考
基于用户提供的详细设计规范，实现以下核心布局：

```
┌─────────────────────────────────────────────────────────────┐
│ A. 顶部元数据区 (Header) - 无底部分割线                      │
│ [Logo] 标题文本 (垂直排列)          [总时长]                 │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────┬───────────────────────────────────────┐
│ B. 左侧主内容 (70%) │ C. 右侧侧边栏 (30%)                  │
│                     │                                       │
│ [文字转录] [节目简介]│ 节目AI总结                            │
│                     │                                       │
│ 模拟对话脚本        │ AI生成的摘要内容                      │
│ 主持人: ...         │                                       │
│ 嘉宾A: ...          │                                       │
│ ...                 │                                       │
└─────────────────────┴───────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│ D. 底部沉浸式播放条 (Bottom Player)                         │
│ [进度条 - 横跨全宽, 2px高, Teal色]                          │
│ [当前时间] [音量]  [⏪15s] [▶️/⏸️] [⏩30s]  [总时间] [1.0x] │
└─────────────────────────────────────────────────────────────┘
```

## 功能需求

### 核心优化项
- [ ] [FO-001] 实现A区：顶部元数据区（无分割线）
- [ ] [FO-002] 实现B区：左侧主内容区（70%宽度）
- [ ] [FO-003] 实现C区：右侧侧边栏（30%宽度）
- [ ] [FO-004] 实现D区：底部沉浸式播放条
- [ ] [FO-005] 实现胶囊状Tab切换

### 功能详述

#### 功能1：A区 - 顶部元数据区 (Header)
**位置**: 页面最顶部
**样式要求**:
- 背景色: 白色 (Colors.white)
- 内边距: 16px
- **无底部分割线** (关键要求)
- 内容布局: Row，左右分隔

**左侧内容 (Logo + 文本)**:
- Logo: 50x50px 容器，Teal背景色，圆角8px，内部Icons.podcasts图标
- 文本: 垂直排列的Column
  - 标题: 16px, FontWeight.bold, 黑色
  - 副标题: 12px, 灰色600, 单行省略

**右侧内容**:
- 总时长: 14px, 灰色500, FontWeight.w500

**数据来源**:
- 标题: `episode.title`
- 副标题: `episode.description` (前40字符)
- 时长: `episode.formattedDuration` 或默认 "3:00"

#### 功能2：B区 - 左侧主内容 (70%)
**布局**: Column，包含Tabs + 内容区域

**Tabs组件**:
- 胶囊状按钮设计
- 两个选项: "文字转录" | "节目简介"
- 选中状态: 背景灰色900，文字白色
- 未选中状态: 透明背景，灰色边框，灰色600文字
- 内边距: 水平16px, 垂直8px
- 圆角: 20px

**文字转录内容**:
- 模拟多人对话脚本
- 每项包含: 说话人标签 + 时间戳 + 内容
- 说话人标签: Teal背景，圆角4px，内边距
- 时间戳: 灰色500，11px
- 内容: 15px, 行高1.6, 黑色87
- 间距: 对话项之间16px

**节目简介内容**:
- 直接显示AI总结文本
- 样式: 15px, 行高1.8, 黑色87
- 内边距: 16px

#### 功能3：C区 - 右侧侧边栏 (30%)
**背景色**: 灰色50 (Colors.grey[50])
**内边距**: 16px

**内容**:
- 仅包含一个Section: "节目AI总结"
- 标题: 14px, 黑色87, FontWeight.bold
- 内容: 13px, 灰色600, 行高1.5

**数据来源**:
- 标题: 固定文本 "节目AI总结"
- 内容: `episode.aiSummary` 或默认文本

#### 功能4：D区 - 底部沉浸式播放条
**背景色**: 白色
**布局**: Column，包含进度条 + 控制区

**1. 进度条 (Slider)**:
- 位置: 播放条最顶端
- 宽度: 横跨整个屏幕
- 高度: 2px (细轨道)
- 激活色: Teal (Colors.teal)
- 未激活色: 灰色300 (Colors.grey[300])
- 滑块: Teal色小圆点
- 支持拖动

**2. 控制区 (Row)**:
- 内边距: 水平16px, 垂直12px
- 布局: 左中右三部分，SpaceBetween

**左边**:
- 当前时间: 格式 "分:秒" (如 "0:32")
- 音量图标: Icons.volume_up, 灰色600, 18px
- 间距: 8px

**中间 (播放控制组)**:
- 回退15s: Icons.replay_10, 灰色, 24px
- 间距: 12px
- **播放/暂停主按钮**:
  - 圆形, 48x48px
  - 背景: Teal (Colors.teal)
  - 图标: 黑色, 28px
  - Icons.play_arrow / Icons.pause (切换)
- 间距: 12px
- 前进30s: Icons.forward_30, 灰色, 24px

**右边**:
- 总时间: "3:00", 14px, FontWeight.w500
- 间距: 8px
- 倍速按钮:
  - 圆角矩形边框
  - 内边距: 水平8px, 垂直4px
  - 边框: 灰色400, 1px
  - 圆角: 12px
  - 文本: "1.0x", 12px, FontWeight.w600, 灰色700
  - 点击循环: 1.0x → 1.5x → 2.0x → 1.0x

## 数据模型

### 模拟对话数据
```dart
final List<Map<String, String>> _dialogueItems = [
  {'speaker': '主持人', 'time': '00:00', 'content': '大家好，欢迎收听本期节目。今天我们来聊聊AI应用的最新发展。'},
  {'speaker': '嘉宾A', 'time': '00:15', 'content': '很高兴来到这里。AI技术确实在快速发展，特别是在自然语言处理领域。'},
  {'speaker': '主持人', 'time': '00:32', 'content': '没错，我们看到很多创新应用。能分享一下你们的具体实践吗？'},
  {'speaker': '嘉宾B', 'time': '00:48', 'content': '当然。我们主要关注企业级应用，帮助客户提升效率的同时降低成本。'},
  {'speaker': '主持人', 'time': '01:05', 'content': '听起来很有价值。听众朋友们，如果你们有任何问题，欢迎在评论区留言。'},
];
```

### 状态管理
```dart
class _PodcastEpisodeDetailPageState extends ConsumerState<PodcastEpisodeDetailPage> {
  bool _isTranscriptTab = true; // true = 文字转录, false = 节目简介
  double _currentProgress = 0.3; // 模拟播放进度 (30%)
  bool _isPlaying = false;
  double _playbackSpeed = 1.0;
}
```

## 技术实现

### 布局结构
```dart
Scaffold(
  backgroundColor: Colors.grey[50],
  body: Column(
    children: [
      // A. 顶部元数据区 (Header)
      _buildHeader(),

      // B. 中间主体内容区 (Body - Row Layout)
      Expanded(
        child: Row(
          children: [
            // 左侧主内容 (Flex 7)
            Expanded(flex: 7, child: _buildMainContent()),
            // 右侧侧边栏 (Flex 3)
            Expanded(flex: 3, child: _buildSidebar()),
          ],
        ),
      ),
    ],
  ),
  bottomNavigationBar: _buildBottomPlayer(),
)
```

### 关键组件
- **Header**: Container + Row，无分割线
- **Tabs**: 自定义胶囊按钮，使用GestureDetector
- **对话项**: Column + Row，说话人标签 + 时间 + 内容
- **进度条**: Slider，自定义颜色和高度
- **播放控制**: 自定义按钮组，主按钮突出显示

## 验收标准

### 功能验收
- [ ] 顶部Header正确显示Logo、标题、副标题、时长，无底部分割线
- [ ] 左侧70%区域正确显示Tabs和内容
- [ ] 右侧30%区域仅显示"节目AI总结"
- [ ] 底部播放条包含进度条和完整控制按钮
- [ ] Tab切换功能正常工作
- [ ] 播放/暂停按钮状态切换正常
- [ ] 倍速按钮循环切换正常
- [ ] 进度条可拖动并更新时间显示
- [ ] 回退/前进按钮更新进度

### 视觉验收
- [ ] 胶囊状Tab按钮样式正确
- [ ] 对话项布局正确（说话人标签、时间、内容）
- [ ] 底部播放条主按钮为Teal背景，黑色图标
- [ ] 进度条为细轨道（2px），Teal色
- [ ] 倍速按钮为圆角矩形边框样式
- [ ] 整体布局比例正确（70% / 30%）

### 数据验收
- [ ] 正确显示模拟对话数据
- [ ] 正确显示AI总结内容
- [ ] 正确处理空数据情况
- [ ] 正确显示时长和时间

## 任务分解

### Frontend任务
- [ ] [TASK-F-001] 实现A区：顶部元数据区
  - 负责人: Frontend Developer
  - 预估工时: 2小时
  - 验收标准: 无分割线，正确布局，数据绑定

- [ ] [TASK-F-002] 实现B区：左侧主内容区
  - 负责人: Frontend Developer
  - 预估工时: 4小时
  - 验收标准: 胶囊Tabs，对话内容，Tab切换

- [ ] [TASK-F-003] 实现C区：右侧侧边栏
  - 负责人: Frontend Developer
  - 预估工时: 1小时
  - 验收标准: 正确宽度，AI总结显示

- [ ] [TASK-F-004] 实现D区：底部沉浸式播放条
  - 负责人: Frontend Developer
  - 预估工时: 3小时
  - 验收标准: 进度条，按钮组，倍速控制

### 测试任务
- [ ] [TASK-T-001] 编写新布局Widget测试
  - 负责人: Test Engineer
  - 预估工时: 3小时
  - 验收标准: 覆盖所有新组件，通过flutter test

## 风险评估

### 技术风险
| 风险项 | 概率 | 影响 | 缓解措施 |
|--------|------|------|----------|
| 布局比例不准确 | 中 | 中 | 使用Expanded(flex: 7/3)精确控制 |
| 状态管理复杂 | 低 | 中 | 使用简单StatefulWidget管理 |
| 模拟数据与真实数据差异 | 中 | 低 | 保持数据结构兼容性 |

### 业务风险
| 风险项 | 概率 | 影响 | 缓解措施 |
|--------|------|------|----------|
| 用户不适应新布局 | 低 | 中 | 保持核心功能不变，仅优化布局 |
| 移动端适配问题 | 中 | 中 | 使用响应式布局，测试不同屏幕 |

## 时间线

### 快速实现计划
- **设计确认**: 立即开始
- **代码实现**: 2025-12-20 (当天完成)
- **测试验证**: 2025-12-20 (当天完成)
- **功能上线**: 2025-12-20 (当天完成)

## 依赖关系

### 内部依赖
- 现有播客详情数据模型
- Riverpod状态管理
- Flutter基础组件库

### 外部依赖
- 无 (纯前端UI实现)

## 变更记录

| 版本 | 日期 | 变更内容 | 变更人 | 审批人 |
|------|------|----------|--------|--------|
| 1.0 | 2025-12-20 | 初始创建 | 产品经理 | 待审批 |

---

**注意**: 此需求基于用户提供的详细设计规范，重点在于实现沉浸式三栏布局和底部播放条，保持设计简洁直观。