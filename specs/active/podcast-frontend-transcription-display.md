# 播客前端转录文本和Shownotes显示功能需求文档

**文档ID**: PRD-2025-002
**创建日期**: 2025-12-21
**负责人**: 产品经理
**状态**: 草稿
**依赖**: PRD-2025-001 (播客音频转录功能)

## 1. 需求概述

### 1.1 问题陈述
用户在收听播客时需要：
- 查看播客节目的详细说明（shownotes）
- 阅读音频的完整转录文本
- 在转录文本中搜索特定内容
- 跟踪当前播放位置在转录文本中的对应位置

### 1.2 目标用户
- 播客听众
- 内容学习者
- 需要快速查找信息的用户
- 偏好文本阅读的用户

### 1.3 业务价值
- 提升用户体验和参与度
- 增加应用使用时长
- 提高内容可发现性
- 支持多样化的学习方式

## 2. 功能需求

### 2.1 Shownotes显示

#### 2.1.1 播客详情页集成
**功能描述**: 在播客分集详情页显示shownotes

**用户故事**:
- 作为用户，我想在播放页看到播客的详细介绍
- 作为用户，我想看到包含链接和格式化的shownotes
- 作为用户，我想能够点击shownotes中的链接

**验收标准**:
- [ ] 在播客详情页新增"简介"或"Shownotes"标签页
- [ ] 支持HTML格式的shownotes渲染
- [ ] 支持链接点击（内部浏览器或外部打开）
- [ ] 支持图片显示
- [ ] 响应式设计，适配不同屏幕尺寸
- [ ] 当没有shownotes时显示友好提示

#### 2.1.2 Shownotes格式化
**功能描述**: 优化shownotes的显示效果

**需求细节**:
- 自动识别和转换URL为可点击链接
- 支持时间戳格式（如 [00:05:30]）
- 支持列表、标题等基本HTML标签
- 代码块特殊处理
- 长内容折叠功能

### 2.2 转录文本显示

#### 2.2.1 转录文本查看器
**功能描述**: 提供完整的转录文本查看功能

**用户故事**:
- 作为用户，我想查看完整的音频转录文本
- 作为用户，我想能够搜索转录内容
- 作为用户，我想能够复制转录文本
- 作为用户，我想调整文本大小

**验收标准**:
- [ ] 新增"转录"标签页
- [ ] 显示完整转录文本
- [ ] 实时搜索功能，高亮匹配文本
- [ ] 文本大小调节（小、中、大）
- [ ] 复制全部或部分文本功能
- [ ] 滚动位置记忆
- [ ] 转录状态显示（转录中、已完成、失败）

#### 2.2.2 音频同步功能
**功能描述**: 将音频播放位置与转录文本同步

**用户故事**:
- 作为用户，我希望播放音频时能看到当前对应文本
- 作为用户，我希望点击文本能跳转到对应音频位置

**验收标准**:
- [ ] 播放时自动高亮当前文本段落
- [ ] 点击文本段落跳转到对应音频位置
- [ ] 显示时间戳（可选）
- [ ] 平滑滚动到当前位置

#### 2.2.3 转录文本增强
**功能描述**: 提供更丰富的转录文本体验

**需求细节**:
- 说话人识别（如果有）
- 关键词高亮
- 段落自动分割
- 导出功能（PDF、TXT）
- 分享功能
- 收藏重要段落

### 2.3 UI/UX设计

#### 2.3.1 布局设计
**Material 3设计规范**:
- 使用TabBar组件切换内容
- Card组件包装不同内容区块
- 适当的间距和圆角
- 响应式布局

#### 2.3.2 交互设计
- 平滑的页面切换动画
- 加载状态指示器
- 错误状态友好提示
- 下拉刷新支持

#### 2.3.3 可访问性
- 支持屏幕阅读器
- 高对比度模式
- 键盘导航支持
- 语义化标签

## 3. 技术实现

### 3.1 前端技术栈
- **框架**: Flutter
- **状态管理**: Riverpod
- **导航**: GoRouter
- **UI组件**: Material 3
- **HTTP客户端**: Dio
- **本地存储**: Hive

### 3.2 数据模型更新

#### 3.2.1 PodcastEpisodeModel扩展
```dart
class PodcastEpisodeModel {
  // 现有字段...

  // 新增字段
  final TranscriptionStatus transcriptionStatus;
  final int transcriptionProgress;
  final String? shownotes; // HTML格式的shownotes
  final List<TextSegment>? textSegments; // 带时间戳的文本段落
}

enum TranscriptionStatus {
  notStarted,
  queued,
  processing,
  completed,
  failed
}
```

#### 3.2.2 TextSegment模型
```dart
class TextSegment {
  final String text;
  final int startTime; // 毫秒
  final int endTime;
  final String? speaker;
  final bool isKeyword;
}
```

### 3.3 组件结构

```
lib/features/podcast/presentation/
├── pages/
│   └── podcast_episode_detail_page.dart
├── widgets/
│   ├── episode_shownotes_widget.dart
│   ├── episode_transcript_widget.dart
│   ├── transcript_search_bar.dart
│   ├── transcript_segment_widget.dart
│   └── sync_progress_indicator.dart
├── providers/
│   └── episode_detail_provider.dart
└── services/
    └── transcription_sync_service.dart
```

### 3.4 API集成

#### 3.4.1 获取转录状态
```dart
Future<TranscriptionStatus> getTranscriptionStatus(int episodeId) async {
  // 调用后端API获取转录状态
}
```

#### 3.4.2 流式更新（可选）
```dart
Stream<TranscriptionProgress> transcriptionProgressStream(int episodeId) {
  // WebSocket或轮询获取实时进度
}
```

## 4. 实现计划

### 阶段1：基础显示（3天）
1. 播客详情页添加TabBar
2. Shownotes显示组件
3. 转录文本基础显示
4. API集成

### 阶段2：交互功能（3天）
1. 转录文本搜索
2. 音频同步功能
3. 文本操作（复制、分享）
4. 状态管理优化

### 阶段3：体验优化（2天）
1. UI动画和过渡
2. 可访问性改进
3. 性能优化
4. 测试和调试

## 5. 用户界面设计

### 5.1 播客详情页布局
```
┌─────────────────────────────────┐
│ 播客封面和标题                   │
├─────────────────────────────────┤
│ [简介] [转录] [评论]             │ ← TabBar
├─────────────────────────────────┤
│                                 │
│  Tab内容区域                    │
│                                 │
└─────────────────────────────────┘
```

### 5.2 转录文本界面
```
┌─────────────────────────────────┐
│ 搜索框 [搜索] [Aa] [更多选项]    │
├─────────────────────────────────┤
│ 🔄 转录中... 75%               │ ← 状态指示器
├─────────────────────────────────┤
│ [00:00] 欢迎来到本期节目...     │ ← 可点击段落
│ [00:15] 今天我们要讨论的是...    │   (高亮当前播放)
│ [00:32] 这个话题很有意思...      │
│ ...                            │
└─────────────────────────────────┘
```

## 6. 测试计划

### 6.1 单元测试
- 转录文本搜索功能
- 时间戳转换
- 状态管理逻辑

### 6.2 集成测试
- API调用正确性
- 音频同步准确性
- 数据持久化

### 6.3 UI测试
- Widget测试
- 交互测试
- 可访问性测试

## 7. 性能优化

### 7.1 文本渲染优化
- 虚拟滚动（长文本）
- 懒加载
- 文本缓存

### 7.2 内存管理
- 及时释放大文本
- 图片缓存控制
- 状态订阅优化

## 8. 未来扩展

- 转录文本翻译功能
- AI生成的章节标记
- 笔记和标注功能
- 社交分享优化
- 离线模式支持

## 9. 成功指标

### 9.1 用户行为指标
- 转录功能使用率
- 平均查看时长
- 搜索功能使用频率
- 文本分享次数

### 9.2 性能指标
- 页面加载时间 < 500ms
- 搜索响应时间 < 200ms
- 音频同步延迟 < 100ms
- 内存使用稳定

## 10. 风险与缓解

### 10.1 风险
- 长文本渲染性能问题
- 音频同步准确性
- 不同设备显示差异

### 10.2 缓解措施
- 虚拟化长列表
- 多平台测试
- 性能监控